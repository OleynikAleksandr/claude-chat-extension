# Release Notes v0.10.19 - Critical Context Window Fix

**Release Date:** July 10, 2025  
**Version:** 0.10.19  
**Type:** Critical Bug Fix  

## 🎯 Critical Fix Summary

This release **completely resolves** the long-standing issue with incorrect context window calculation when using `claude resume` to continue old sessions.

### 🔧 What Was Fixed

**Problem:** When resuming old Claude Code sessions, the context window indicator showed incorrect values:
- First few messages: ~10k tokens (incorrect)
- After several exchanges: ~100k+ tokens (correct)

**Root Cause:** The parser was only using `cache_read_input_tokens` and ignoring `cache_creation_input_tokens`.

**Solution:** Context window is now correctly calculated as:
```
Context Window = cache_creation_input_tokens + cache_read_input_tokens
```

## ✅ What's Fixed in 0.10.19

### Critical Issues Resolved
- ✅ **Context Window Calculation**: Now shows correct token counts immediately
- ✅ **Session Resume Compatibility**: Perfect support for `claude resume` command
- ✅ **Immediate Display**: No delay in showing accurate context information
- ✅ **Summary Format Support**: Full compatibility with new Claude Code JSONL format
- ✅ **UI Cleanup**: Removed redundant token information from service block

### Example Fix
**Before:** Resume session shows 10,241 tokens (incorrect)  
**After:** Resume session shows 107,420 tokens (correct: 97,179 + 10,241)

## 🚀 Installation

### Option 1: Install from VSIX
1. Download `claude-chat-0.10.19.vsix`
2. In VS Code: `Extensions > Install from VSIX...`
3. Select the downloaded file

### Option 2: Marketplace (Coming Soon)
Search for "Claude Chat" in VS Code Extensions marketplace.

## 🔄 Upgrade Notes

### From Previous Versions
- **Automatic**: Context calculation is automatically corrected
- **No Config Changes**: All existing configurations remain valid
- **Backward Compatible**: Works with all Claude Code versions

### Testing Your Installation
1. Resume an old Claude Code session with `claude resume`
2. Check that context window indicator shows correct values immediately
3. Verify no token count jumps or delays

## 🐛 Bug Fixes in This Release

### v0.10.16-0.10.18 (Previous attempts)
- Added summary format support
- Improved JSONL parsing
- Enhanced filtering logic

### v0.10.19 (Final solution)
- ✅ **CRITICAL**: Correct context window calculation
- ✅ **Parser Enhancement**: Sums both cache token fields
- ✅ **Immediate Fix**: No waiting for "second response"

## 📋 Technical Details

### Changed Files
- `JsonlResponseMonitor.ts`: Updated context calculation logic
- `package.json`: Version bump to 0.10.19
- `CHANGELOG.md`: Added release notes
- `README.md`: Updated version and features

### Code Changes
```typescript
// Before (incorrect)
cache_read_input_tokens: this.validateTokenCount(entry.message.usage?.cache_read_input_tokens)

// After (correct)
const cacheCreationTokens = this.validateTokenCount(entry.message.usage?.cache_creation_input_tokens);
const cacheReadTokens = this.validateTokenCount(entry.message.usage?.cache_read_input_tokens);
const totalContextTokens = cacheCreationTokens + cacheReadTokens;
```

## 🙏 Acknowledgments

Special thanks to the user who identified that context window requires **summing both token fields**. This critical insight led directly to the solution after extensive investigation.

## 📞 Support

- **Issues**: [GitHub Issues](https://github.com/OleynikAleksandr/claude-chat-extension/issues)
- **Discussions**: [GitHub Discussions](https://github.com/OleynikAleksandr/claude-chat-extension/discussions)
- **Email**: contact@oleynik.dev

## 🔜 What's Next

With the critical context window issue resolved, future releases will focus on:
- Performance optimizations
- Additional Claude Code feature support
- Enhanced user experience improvements

---

**This release represents a major stability milestone for ClaudeCodeBridge.** All known critical issues with Claude Code session handling are now resolved.
EOF < /dev/null